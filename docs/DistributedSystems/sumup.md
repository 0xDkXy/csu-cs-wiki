# 绪论

## 分布式系统简述

- 分布式系统目标
  - 资源共享(resource sharing)
    - 一些计算机通过网络连接起来，并在这个范围内有效地共享资源
    - 硬件的共享，软件的共享，数据的共享，服务的共享
    - 媒体流的共享（动态的资源形式）
  - 协同计算(collaborative computing)
    - 并行计算，分布式计算
- 分布式系统定义
  - 一种定义：A distributed system is defined as one in which **components** at **networked computers communicate** and **coordinate** their actions only by **passing messages**.
  - Andrew S. Tanenbaum：分布计算系统是由多个独立的计算机系统相互连接而成的计算系统，从用户的角度来看它好像是一个集中的单机系统。
  - Enslow：分布式系统=分布式硬件+分布式控制+分布式数据
  - 总结：分布式计算机系统是由若干非共享内存和时钟的计算机或自治处理单元（PE）组成，它们通过一个计算机网络彼此交换消息，并且每个 Pe 有自己的内存和运行自己的操作系统，它们在整个系统的控制下可协作执行一个共同的任务。
- DOS（分布式操作系统）、DOS（网络操作系统）、Middleware（中间件），逐级走向上层，上面是 Distributed Applications（分布式应用）。
  - Middleware Examples：Sun RPC, CORBA, DCOM, Java RMI
  - 三类中间件
    - transaction oriented (for distributed database applications，分布式数据库应用)
    - message oriented (for reliable asynchronous communication，稳定异步通信)
    - remote procedure calls (RPC) – the original OO middleware

<!--more-->

- 分布式计算
  - 比较：并行计算 vs 分布式计算
    - 并行计算借助并行算法和并行编程语言能够实现进程级并行（如 MPI）和线程级并行（如 openMP）。而分布式计算只是将任务分成小块到各个计算机分别计算各自执行。
    - 粒度方面，并行计算中，处理器间的交互一般很频繁，往往具有细粒度和低开销的特征，并且被认为是可靠的。而在分布式计算中，处理器间的交互不频繁，交互特征是粗粒度，并且被认为是不可靠的。并行计算注重短的执行时间，分布式计算则注重长的正常运行时间。
- 网格计算
  - 分布式计算的一种
  - 网格计算的实质就是组合与共享资源并确保系统安全。网格计算通过利用大量异构计算机的未用资源（CPU 周   期和磁盘存储），将其作为嵌入在分布式电信基础设施中的一个虚拟的计算机集群，为解决大规模的计算问题提供一个模型。网格计算的焦点放在支持跨管理域计算   的能力，这使它与传统的计算机集群或传统的分布式计算相区别。
- 云计算
  - 云计算是最新开始的新概念，它不只是计算等计算机概念，还有运营服务等概念了。**它是分布式计算、并行计算和网格计算的发展**，或者说是这些概念的商业实现。云计算不但包括**分布式计算**还包括**分布式存储**和**分布式缓存**。分布式存储又包括分布式文件存储和分布式数据存储。
- 普适计算
  - 普适计算（Pervasive / Ubiquitous Computing）是指，无所不在的、随时随地可以进行计算的一种方式；无论何时何地，只要需要，就可以通过某种设备访问到所需的信息。
  - 最重要的两个特征：间断连接；轻量计算（即计算资源有限）
- 分布式系统中的主要特征
  - 分布性
  - 对等性
  - 异构性
    - 网络、计算机硬件、操作系统、编程语言、不同开发商的实现
    - 隐藏异构性：**中间件技术**、**虚拟机技术**
  - 并发性
    - 多个程序（进程，线程）并发执行，共享资源
    - CAP （Consistency, Availability, Partition Tolerance）
  - 缺乏全局时钟
    - 每个机器的有各自的时间，没有办法做到统一，程序间的协调靠交换消息
  - 故障独立性
    - 一些进程出现故障，并不能保证其它进程都能知道
  - 容错性
    - 常用的容错方法是冗余配置
    - 三种形式：信息冗余、时间冗余、物理冗余
  - 安全性
- 分布式系统的目标
  - 可访问性
    - 分布式系统最主要目标是使用户能够方便地访问远程资源，并且以一种受控的方式与其他用户共享这些资源
  - 开放性
    - 通过接口提供标准服务
    - 允许进程之间之间通过接口通信
    - 分布式系统能够方便地将不同人员开发的组件组合成系统
  - 可扩展性
    - 是指系统为了支持持续增长的任务数量可以不断扩展的能力，通过扩展能够获得高性能、高吞吐量和低延迟
    - 可扩展性度量：规模上可扩展、地域上可扩展、管理上可扩展
    - 设计上的挑战
      - 控制物理资源的代价，e.g.,随着用户数的增长，服务器的增长代价不能超过 O(n)
      - 控制性能损失, e.g., DNS no worse than O(logn)
      - 控制软件资源被耗尽，e.g., IP address
      - 防止性能瓶颈, e.g., partitioning name table of DNS, cache and replication
    - 理想状态下，系统规模增加时系统和应用程序应该不需要随之改变
  - 可用性
    - 是一个系统尽可能地限制潜在风险发生的能力
    - 快速检测错误机制：定期检测每个服务器的状态
    - 快速启动恢复程序机制：通过复制和冗余实现
    - $availability＝uptime / (uptime + downtime)$
      - uptime：正常运行时间
      - downtime：出现故障的停机时间
    - 习惯用 N 个 9 来表征系统可用性，如 99.999%（5-nines availability)
  - 可靠性
    - 指一个分布式系统在它某一个或多个硬件的软件组件发生故障时，仍能提供服务的能力
      - $R = e^{-\lambda t} = e ^ {-t/\theta}$
      - $t$：运行时间
      - $\lambda$：失效率
      - $\theta = 1/\lambda = MTTF$
    - 里路是内行，系统可靠性是所有组件可靠性的“布尔或”
  - 透明性
    - 隐藏进程和资源在多台计算机上分布的事实
    - 访问透明：相同的操作访问本地和远程资源
    - 位置透明：访问资源无须知道其物理或网络位置
    - 迁移透明：客户或资源的移动不影响该资源的访问方式
    - 复位透明：资源可以在接受访问时进行重新定位
    - 复制透明：隐藏同一个资源存在多个副本的事实
    - 并发透明：任何一个用户都不会感觉到他人在与自己共享使用资源
    - 故障透明：屏蔽故障
    - 持久性透明：对资源位于易失性存储器中还是位于磁盘上的隐藏
    - 性能透明
    - 伸缩透明
- 分布式系统的类型
  - 分布式计算系统
    - 集群计算（Cluster Computing）
    - 网格计算（Grid Computing）
    - 云计算（Cloud Computing）
  - 分布式信息系统
    - 事务处理系统（Transaction Processing System）
    - 企业应用集成（Enterprise Application Integration）
  - 分布式普适系统
    - 家居系统（Home Systems）
    - 电子医疗保健系统（Electronic Health Care Systems）
    - 传感器网络（Sensor Networks）

## 分布式系统的拓扑结构

课下自学

## 分布式与计算机网络

课下自学

## 分布式体系结构

- 体系结构样式
  - 分层体系结构
    - 组件组成了不同的层，其中 L 层中的组件可以调用下面的层
    - 网络通信
  - 基于对象的体系结构
    - 对象对应一个组件
    - 组件通过（远程）过程调用机制（RPC）连接
  - 以数据为中心的体系结构
    - 基于 Web 的分布式系统大部分是以数据为中心的
  - 基于事件的体系结构
    - 进程基本上通过事件的传播来通信，事件传播可携带数据
    - 发布-订阅系统
- 分布式系统体系结构
  - 集中式体系结构
    - 客户-服务器：请求-回复行为
  - 非集中式体系结构
    - 将客户-服务器程序组成多层体系结构
    - 垂直分布/水平分布
  - 混合式体系结构
    - 边界服务器系统（edge-server system）:用于优化内容和应用程序的分布性
    - 协作分布式系统：文件共享系统(BitTorrent)

## 分布式和云计算机系统模型

- 协同计算机集群
  - 集群体系结构
    - 通过使用 SAN、LAN 或 WAN 构成层次化结构，可以通过增加一定数量的节点建立可扩展的集群。
- 单系统镜像
  - SSI 使集群在用户看来像一个单独的机器
- 硬件、软件和中间件支持
- 计算网络
  - 一个计算网格提供一个基础设施，可以把计算机、软件/中间件、特殊指令、人和传感器结合起来。网格通常被架构在 LAN、WAN 或者地区性、全国性或全球规模的互联网骨干网络上。企业或组织将网格呈现为集成的计算资源。它们也可以被视为支持虚拟组织的虚拟平台。
- 对等网络家族
  - P2P 系统
  - 覆盖网络
    - 覆盖网络的目的是为了支持将消息路由到目的地不由 IP 地址指定的位置
    - 非结构化的和结构化的。非结构化的覆盖网络可以用随机图来描述；结构化覆盖网络遵循确定的连接拓扑和从覆盖图中插入与删除对等节点（peer ID）的规则。
- 互联网上的云计算
  - 互联网云：云计算提供了一个虚拟化的按需动态供应硬件、软件和数据集的弹性资源平台（IaaS、SaaS、FaaS）

## 分布式系统和云计算软件环境

- 用以支持分布式的技术
  - Ad hoc 网络编程：主要依靠进程间通信（interprocess communication，IPC）机制,如共享内存、管道以及套接字（Socket）
  - 结构化通信：提供较高层次的通信机制如：RPC
  - 中间件
    - 网络环境下处于操作系统、数据库等系统软件和应用软件之间的一种祁连街作用的分布式软件
    - 主要解决异构网络环境下分布式应用软件的互连与互操作问题，提供标准接口、协议，屏蔽实现细节，提高应用系统的易移植性
- 分布式对象计算中间件
  - 分布式对象计算中间件技术代表了两种主要信息技术的结合：基于 RPC 的分布式计算系统和面向对象的设计与编程技术。
    - CORBA
    - Java RMI
- 组件中间件

  为了解决缺少功能边界的问题，组件中间件技术允许一组高内聚的组件对象通过提供或请求接口的方式来实现交互，同时它还定义了在普通应用服务器上执行这些组件对象所需要的标准运行时机制

  - EJB
  - CORBA 组件模型（CCM）

- 发布-订阅中间件和面向消息的中间件

  - 结构化通信方案
  - 异步通信

- 分布计算系统设计
  - ![DS_1](https://eddyblog.oss-cn-shenzhen.aliyuncs.com/DistributeSystemLearning/dis.png)

## 分布式系统的趋势

- 泛在联网和现代互联网
- 移动计算和无处不在的计算
  - 设备小型化、无线网络发展
  - 设备的便携性和方便的网络连接能力->移动计算
  - 移动性为分布式系统带来了一系列的挑战
- 分布式多媒体系统
  - 分布式系统中支持多媒体服务的需求
  - 网络播放——分布式多媒体技术应用
- 分布式做共有设施（公有云?）
  - 阿里云、腾讯云、360 云盘、百度云、Amazon

## 分布式系统的挑战

- 存在的问题
  - 分布式系统的故障表现为间歇性错误或性能下降
  - 固有的复杂度
  - 附加的复杂度
  - 方法和技术上的不足
  - 对核心概念和技术持续的重新创建和重新发现

### 异构性

- **中间件**——是指一个软件层，它提供了一个编程抽象，同时屏蔽了底层网络、硬件、操作系统和编程语言的异构性。
  - 公共对象请求代理（CORBA）
  - JAVA 远程调用方法
  - 大多数中间件**基于互联网协议**实现，这些协议**屏蔽了底层网络的差异**，但是中间件**要解决操作系统和硬件的不同**。
- **移动代码**——是指从能从一台计算机发送到另一台计算机，并在目的计算机上运行的代码（例如：Java applet）
- **虚拟机**——提供了一种代码可以在任何计算机上运行的方法：某种语言的编译器生成一台虚拟机代码而不是某种硬件代码，虚拟机通过解释的方式来执行它。

### 开放性

- 开放性决定系统能否以不同的方式被扩展和重新实现
- 分布式系统的开放性主要取决于新的资源的共享服务能被增加和供多种客户程序使用的程度
- 开放的分布式系统的特点:
  - 发布系统的关键接口开放系统的特征
  - 基于一致的通信机制和发布接口访问共享资源
  - 能用异构硬件和软件构造
- 挑战
  - 计算机系统的开放性
    - 一个系统是否可以扩充以不同的方式重新实现。例如：UNIX
  - 分布式系统的开放性
    - 在多大程度上新的资源共享服务可以加到系统中来。例如：WEB, plug-in
    - RFC

### 安全性

- 分布式系统中使用和维护的众多信息资源，具有很高的内在价值，安全性相当重要。
  - 机密性（Confidentiality）
    - 防止未经授权的个人访问资源
    - e.g. ACL in Unix File System
  - 完整性(Integrity)
    - 防止数据被篡改和破坏
    - e.g. checksum
  - 可用性（Availability）
    - 防止对所提供服务的干扰
    - e.g. Denial of service
- 应用案例：
  - 医生请求访问医院病人的数据或发送新增的病人数据
  - 用户在互联网上发送信用卡号码
- 拒绝服务攻击
- 移动代码的安全性

### 可伸缩性

如果资源数量和用户数量激增，系统仍能保持其有效性，那么该系统就称为可伸缩的。

### 故障处理

- 故障不可避免
- 分布式系统故障一般来说是部分的
- 有些组件正常而有些组件出现故障
- 故障处理技术：
  - 检测故障
  - e.g. 用校验和检测数据
  - 但是在分布式系统中确切的知道远程服务器是否出现故障是很难做到的。
- 屏蔽故障
  - e.g. 重发没有收到的消息, 备份服务器等
- 故障容错
  - e.g. 无法做到屏蔽故障，至少让用户知道出现了问题，让用户自由选择是否继续请求服务。
- 故障恢复
  - e.g. 操作日志，恢复。
- 冗余策略
  - e.g. IP route, replicated name table of DNS

### 并发性

- 分布式系统中，服务和应用均提供可被客户共享的资源
- 几个客户同时试图访问一个共享资源
- 代表共享资源的任何一个对象必须负责确保在并发环境中操作正确，不仅适用于服务器，也适用于应用中的对象

### 透明性

- 访问透明（Access transparency）
  - 使用同样的操作去访问本地资源和远程资源。E.g. NFS / Windows File Sharing
- 位置透明（Location transparency）
  - 访问资源的时候，不需要知道资源的位置。E.g. URL
- 并发透明（Concurrency transparency）
  - 几个进程同时访问资源，互不干扰
- 复制透明（Replication transparency）
  - 使用多个资源的副本来提高可靠性和性能，用户或者应用程序开发者并不需要了解副本技术。
- 故障透明（Failure transparency）
  - 在存在故障的情况下，用户和应用仍可完成他们的任务, e.g., email

### 服务质量

- 服务质量：系统的主要非功能特性
- 影响用户体验的服务质量包括：
  - 可靠性
  - 安全性
  - 性能
  - 适应性

# 范型和抽象

## 抽象

`抽象->理论->设计`，计算机科学研究的三种形态，对应学科问题求解中三个典型过程。

`抽象`：源于实验学科，抽象的结果是**概念、符号、模型**。

`理论`：源于数理，主要为定义、定理、公理、证明与结果解释，研究内容跟的基本特征是构造性数学特征。

`设计`：源于工程学，用来开发求解给定问题的系统和设备主要是需求说明。

## 范型

范型是**一种模式、例子、模型**。（不同形式语言有不同的范型，面向对象、底层 blabla）。**识别基本模型并根据模型分类在研究解决复杂问题时非常有用。**

本章视图描述分布式系统模型、应用的范型、物理模型等等进行分类。

<!--more-->

## 系统模型分类

`物理模型`：考虑组成系统的计算机和设备的类型以及它们的**互联**，不涉及特定的技术细节。

`体系结构模型`：从系统的计算元素执行的**计算和通信任务**来描述系统。

`基础模型`：采用抽象的挂点描述大多数分布式系统面临的单个问题的方案。（交互模型 && 故障模型 && 安全模型）。

### 物理模型

**早期分布式系统**和初期**互联网规模的分布式系统**特征静态、分立、自治。

**当代的分布式系统**特征

- 移动计算：节点移动
- 无处不在的计算：嵌入日常物品周围环境
- 云计算：一组节点提供给定服务

### 体系结构模型

一个系统体系结构是指：各个独立指定组件的**结构**，

- **整体目标**：确保**结构**能满足现在和将来可能的需求。
- **主要关心**：系统可靠性、适应性、可管理型和性价比

体系结构元素与常见问题

- 通信实体是什么
- 如何通信（通信范型）
- 扮演的角色及承担的责任是什么
- 如何映射到具体的基础设施上（放置）

#### 体系结构元素——通信实体

- 面向系统的角度：线程、进程、结点。
- 面向问题的角度：对象（自然单元）、组件（提供的接口和所需接口）、Web 服务（经常跨越组织边界）。

- 进程间通信：相对底层支持（套接字、多播、消息传递）
- 远程调用：最常见的通信范型，双向交换

  - 请求——应答协议（RR）：一对消息的交换
  - 远程过程调用（RPC）：远程计算机上进程中的过程能被调用
  - 远程方法调用（RMI）：一个发起调用的对象可以调用一个远程对象中的方法

    进程通信及远程调用的限制：

  - 发送者需要知道接收者（空间耦合）
  - 发送者和接收者同时存在（时间耦合）

- 间接通信（时间空间解耦合）
  - 组通信：一对多通信范型
  - 发布——订阅系统：提供一个中间服务，有效确保生产者生成的消息被路由到需要这个消息的消费者（体系结构生产者消费者问题特化，特对特）
  - 消息队列：提供点到点服务
  - 元组空间：进程可把任意结构化数据存放在一个持久化元组空间，其他进程可读可删除。
  - 分布式共享内存：用于支持在不共享物理内存的进程间共享数据

小结

![Distribute_Paradigms_1](https://eddyblog.oss-cn-shenzhen.aliyuncs.com/DistributeSystemLearning/DistributeParadigms/distribute_paradigms_1.png)

#### 体系结构元素——中间件内容补充

操作系统及以下，归为平台（Platform），最上层是应用服务，中间有一个中间件（MiddleWare）。

**中间件提供一个编程抽象来屏蔽异构问题**，主要解决包括：

- 硬件
  - 数据类型在不同硬件平台上表示不同
  - 存储方式不同（PowerPC 采用 big-endian，X86 采用 little-endian）
- 通信协议
  - 独立于网络底层的传输协议（底层无关）
- 操作系统
  - 在操作系统上提供更高级的抽象 API，屏蔽操作系统级的异构
- 编程语言
  - CORBA 通过 IDL，可以使得不同的语言写的代码互相调用
  - CORBA——公共对象请求代理结构

#### 体系结构模型——分布式系统结构的设计需求

设计考虑：

- 系统组件间的责任划分
- 组件在网络上的放置
- 等等

影响 1：**性能问题**

- 响应能力
  - 服务器和网络负载
  - OS 中间件与代码引起的延迟
- 吞吐量
- 负载平衡

影响 2：**QoS 服务质量**

- 可靠性、安全性
- 适应性
- 性能一般体现在响应与吞吐，但是还有一些新的解释
- 强时间性数据（time-critical data）
- QoS 可以在操作系统层、网络层等多个层级实现

影响 3：**缓存和复制的使用**

- 缓存复用频度
- 优化访问时间

影响 4：**可靠性问题**

- 正确性
  - 形式化验证
  - Model Checking
  - 测试技术
- 容错性
  - 冗余是关键
- 安全性
  - 保证数据不受攻击
  - 通过网络访问数据的权限

#### 体系结构模型——客户-服务器模式

客户端 Client 发出 Invocation，服务端 Server 返回 Result。

CS 模式 C 端比较肥胖，分担了 S 端一些任务，但同样，result 计算却又只在，S 端进行。S 端和网络也是瓶颈。

#### 体系结构模型——层次化体系化结构

层次化与分层体系结构互补，是一项组织给顶层功能的技术。层次化应用功能分解。（MVC，MVV?）

- 表示逻辑：用户交互与用户应用视图逻辑
- 应用逻辑：设计应用相关（业务逻辑）详细的应用特定储里
- 数据逻辑：涉及应用的持久存储，通常在一个数据库管理系统中。

#### 体系结构模型——P2P 体系化结构

结构化 P2P（分布式哈希表 DHT 映射）与非结构化 P2P，与混合 P2P

#### 体系结构模型变体

思路：

- 使用多个服务器和缓存，增加性能和灵活性
- 使用移动代码和移动代理
- 用户硬件喜好
- 弹性扩展删除的需求

方式

- 服务器组
- 代理服务器与缓存
- 移动代码（服务器与客户端传递）
- 移动代理（Server 间传递）
- 网络计算机

## 分布式通信范型

### 进程间通信

- 同一节点（操作系统/体系结构中学习）
  - 管道
  - 消息队列
  - 共享内存
- 不同节点
  - 基于套接字
  - 报文传递

#### 消息传递

- 发送与接收原语
- 阻塞/非阻塞：同步型/异步
- 有缓冲/无缓冲（Buffer）

#### 超时和线程

阻塞机制为 IPC 提供了必要的同步，但导致的无限挂起问题通常不能被接受，解决方案

- 超时机制（Timeout）设置最大阻塞期限
- 子进程、线程提供组赛操作，主线程 or 父进程可继续其他储里（挂起子进程或子线程）。
- 解决死锁（协议误解或者程序错误）

#### IPC 数据表示引例

在网络体系的物理层中，数据被表示成二进制流，并作为模拟信号进行传输。在应用层中，为支持编程语言提供的数据类型和数据结构，需要用更为复杂的数据表示方法来表示待传输的数据。（如 big endian 与 little endian 的问题）

一些更优的分布式解决方案

#### 数据编码

尽管可以用专门定制的程序，采用双方认同的任意一种数据组装方案执行 IPC（IPC 前的额外程序接口），通用分布式应用要求为交换数据编码提供通用的、独立于平台的方案。因此一些有关网络数据编码的标准应运而生。

外部数据表示和编码

三种外部数据表示和编码方法

- CORBA 的公共数据表示
- Java 的对象序列化
- XML（可扩展标记语言）

此外 Goggle 采用协议缓冲区（protocol buffer），JSON（JavaScript Object Notation）也是近年来常用的外部数据表示方法。

- 序列化：将一个对象或者一组关联对象打平成适合于磁盘存储或消息传送的串行格式
- 解序列化： 从串行格式中恢复对象或一组对象的状态

Java 反射的应用

- 实现了根据类名创建类的能力，以及为给定的类创建具有给定参数类型的构造函数
- 反射使得以完成通用的方式进行序列化和反序列化成为可能
- Java 对象序列化使用反射找到要序列化的对象的类名，以及该类的实例变量的名字、类型和值

（解序列化有时候像一个动态生成类的过程）

#### 组播通信

- 单个消息从一个进程发送到译组进程的每个成员的操作
- 组的成员对发送方常是透明的
- 组播的行为有很多种情况，最简单的组播不提供消息传递保证或排序保证

组播消息为构造具有下列特征的分布式系统提供了基础设施：

- **基于复制服务的容错**（比如 Raft 协议，Leader Election 过程都是基于组播通信）
- 在自发网络中发现服务
- 通过复制的数据获得更好的性能（找寻恢复？）
- 事件通知的传播（包括内网穿透等）

#### 网络虚拟化

网络虚拟化涉及在一个已有的网络之上构造多个不同的虚拟网络

每个虚拟网络被设计成支持一个特定的分布式应用

- 多媒体数据流
- 多人在线游戏

面向特定应用的虚拟网络构建在一个已有的网络上并为特定的应用进行优化，而不改变底层网络的特征。

##### 覆盖网络

积淀和虚拟链接组成的虚拟网络，位于一个底层网络之上

- 满足一类应用需求的服务器胡总一个特别高层的服务，例如多媒体内容分发
- 在一个给定的联网环境中的更有效的操作
- 额外特色，例如：组播或安全通道

好处

- 不改变底层网络就能定义新的网络服务
  - 取决于该领域标准化的水平和修补底层路由功能的困难
- 鼓励对网络服务进行实验和对服务进行面向特定应用的定制
- 能定义多个覆盖王，它们能同时存在，从而行成更开放和拓展的网络体系结构

不足

- 引入了额外的间接层

与属虚的分层概念相关

- 一个覆盖网是一层，TCP/IP 结构外存在的一层
- DIY 该层核心元素：寻址模式、要采用的协议、路由方法等。

### 客户-服务器范型

注意说的是**通信范型还是体系结构**

CS 范型服务器扮演服务提供者决策，被动地等待请求的到达。

#### 寻址

- 为了发消息给服务器，客户必须知道服务器的地址
- 进程编址方法
  - 客户机代码中指明机器/进程号（machine，process number）：文件服务器不透明（类似于绝对地址）
  - 给每个进程分配唯一地址->中央服务器（单点故障）
  - 让进程选择随机地址，用广播定位进程：额外的系统负担
  - 在客户机中存放 ASCII 服务器名字，运行时寻找它：需要命名服务器（有点像 DNS）

#### 阻塞与非阻塞原语

- 有一个要求？？消息要是不可修改的（WHY？）

#### 有缓冲和无缓冲原语

- 无缓冲的形式，当多 C 访问 S 时可能会造成消息丢失的问题
- 解决：缓冲，邮箱 blablabla

#### 可靠的和非可靠原语

- 可靠：请求后多一个 ACK（内核到内核的确认）

### P2P 范型

#### 集中目录式结构

用户注册与文件检索过程类似于传统的 C/S 模式
，区别在于**所有资料并非储存在服务器上，而是储存在各个节点中**。查询选择合适的节点建立直接连接。

这种结构简单，显示系统信息量的巨大优势和吸引力，同时也揭示了 P2P 系统本质上所不可避免的两个问题：法律版权和资源浪费的问题。

#### 纯 P2P 网络模型

广播式 P2P，取消集中的中央服务器。现在应用最广泛的纯 P2P 非结构化拓扑模型——Gnutella 模型。

明显的问题：易受垃圾信息和病毒的恶意攻击，搜索算法是泛洪方式，低效性。

#### 混合式网络模型

Kazza 模型是代表，引入超级节点的概念。根据节点能力不同（计算能力、内存大小 blabla）

#### 结构化网络模型

结构化/非结构化根本区别：每个节点所维护的邻居是否能够按照某种全局方式组织起来以利于快速查找。

目前的主流方式：分布式哈希技术（DHT）。目前扩展性最好的 P2P 路由方式质以。借助 DHT 的优势，取消泛洪算法，又可有效达到目标节点。

### 远程过程调用范型

范型简介补充，自行了解

- 请求应答协议
- 远程过程调用（RPC），将传统的过程调用模型**扩展**到分布式系统中，允许客户程序透明地调用在服务程序中的过程。
- 远程方法调用（RMI），基于对象的编程模型的扩展，允许不用进程运行的对象通过其彼此通信。是对本地方法调用的扩展。（数据库操作中，ODBC）

#### RPC 主要步骤

略

#### RPC 的设计问题

- RPC 编程风格——接口编程
- RPC 关联的调用语义
- 透明性的关键问题和它如何与远程过程调用相关联

#### 接口编程

- 一些编程语言提供了把程序组织成很多个模块+彼此通信的方法。（面向对象编程典型）
- 模块间通信依靠模块间过程调用/访问变量
- 通过模块定义显示接口，接口访问过程和变量。
- 实现的接口可以隐藏除接口外的所有信息，只要模块接口保持相同，模块的实现就可以随意改变而不影响模块的使用。

#### 分布式系统的接口

- 分布式程序中，模块能够运行在不同的进程中
- 服务接口，涉及服务器提供过程的说明、定义和每个过程参数的格式
- 分布式编程中使用接口的好处
  - 对于任何形式的模块化编程，只需要关系服务接口提供的抽象而不需要关注它们的实现细节（比如 Map、Reduce）
  - 程序员无需知道实现服务的语言和底层平台
  - 只要接口保持不变，实现可以改变，自然的支持软件的演化。
- 接口定义受到分布式底层基础设施的影响
  - 某进程访问另一个进程中模块的变量是不可能的
  - 本地过程调用使用参数传递机制，不适用于调用者和过程在不同进程中的情况
    - 不支持引用的传递
    - 某个参数同时作为输入/输出时，请求和应答必须传值
    - 内存地址无效化，不能作为调用结果返回（没有意义）
- 接口定义语言（IDL）
  - RPC 可以集成在编程语言中
  - 接口定义语言，跨语言，以不同语言实现过程以便相互调用

### 远程方法调用

- 远程方法调用（Remote Method Invocation，RMI）
  - 与 RPC 紧密联系，RMI 扩展到了分布式对象的范畴
  - 访问对象能够调用位于潜在的远程对象上的方法
  - RPC 和 RMI 的共性如下：、
    - 都支持接口编程
    - 都是典型的基于请求—应答协议构造的，并提供一系列如最少一次、最多一次调用语义
    - 都提供相似程度的透明性
  - RMI 的特殊性：
    - 程序员能够在分布式系统软件开发中使用所有面向对象编程的功能
    - 基于面向对象系统中对象标识的概念，在基于 RMI 系统中的所有对象都有唯一的对象引用

#### 远程对象调用

- 客户端调用远程对象中的一个方法时，就会向存放远程对象的服务器进程发送一个调用消息。这个消息需要指定哪一个对象具有要调用的方法。
- 远程对象引用（remote object reference）是远程对象的标识符，在整个分布式系统中有效。
- 远程对象引用在调用消息中传递，以指定调用哪一个对象。
- 远程对象应用必须确保空间和时间唯一性的方法生成
  - 在远程对象上有许多进程，所以远程对象引用在分布式系统的所有进程中必须是唯一的

#### RMI 的设计问题

- 远程接口
  - 远程对象的类实现其远程接口中的方法
    - 例如：在 Java 中作为公有实例方法实现
    - 其他进程中的对象只能调用属于其远程接口的方法
    - 注意：和所有接口一样，远程接口没有构造函数
- 分布式对象系统中的动作
  - 一个动作是由方法调用启动的，这可能会导致其他对象上的方法调用
  - 但是在分布式情形下，涉及一连串相关调用的对象可能处于不同的进程或不同的计算中
  - 当调用跨越了进程或计算机的边界时，就要使用 RMI，此时，对象的远程引用必须对调用者是可用的
- 分布式对象系统中的无用单元收集
  - 如果一个语言支持无用单元收集，那么任何与之相关的 RMI 系统也应该支持远程对象的无用单元收集。
  - 分布式无用单元收集通常通过已有的本地无用单元收集器和一个执行分布式无用单元收集的附加模块的协作来实现。
- 异常
  - 任何远程调用都可能会因为被调用的对象的种种原因而失败
  - 远程调用方法应该能够引起异常
  - CORBA IDL 提供了指定应用级异常表示法。CORBA 客户程序要能处理异常。

### 间接通信范型

加入中介

- 在分布式系统中实体通过中介者进行通信，没有发送者和接收者（们）之间的直接耦合
- 注意：接收者可以是多个，很多间接通信范型明确支持一对多通信
- 前面介绍的技术都是基于发送者和接收者之间的直接耦合
  - 考虑简单的客户—服务器交互，因为是直接耦合，用相同功能的另一台服务器代替原来的服务器很困难。
  - 服务器故障后，客户必须显式的处理故障
- 间接系统的主要缺点是：
  - 增加间接层带来的性能开销
  - 更加难以精确管理
- 与异步通信的关系
  - 在异步通信中，发送者发送一个消息，然后继续工作（不阻塞），因此不需要与接收者在同一时间通信。
  - 时间解耦增加了额外的维度，发送者和接收者（们）可以互相独立存在。例如：接收者在通信发起时可能不存在。

### 元组空间通信

内容可寻址内存进行访问

- 元组空间是耶鲁大学的 David Gelernter 作为分布式计算的一种新形式引入的，它基于 David Gelernter 提出的“生成通信”
- 进程通过在元组空间放置元组间接地进行通信，其他进程可以从该元组读或删除元组
- 元组没有地址，但是可以通过内容上的模式匹配进行访问（内容可寻址的内存）
- 所形成的 Linda 编程模型有很广泛的影响力，并在分布式编程方面带来了重大的发展，包括：Agora 系统，Sun 的 JavaSpaces 和 IBM 的 Tspaces
- 元组空间通信在无处不在的计算领域也很有影响
- 与元组空间相关的特性
  - 空间解耦：放置在元组空间中的元组可能源自任何数量的发送者进程，也可能被传递到任何一个潜在的接收者
  - 时间解耦：放置在元组空间中的元组会保留在元组空间中直到被删除（可能是无限期的），因此，发送者和接收者不需要在时间上重叠
- 这些特性提供了一种在空间和时间上完全分布的方法，还通过元组空间提供了一种共享变量的分布式共享形式

## 网络服务范型

本质上，网络服务范型是对远程方法调用范型的扩展，区别在于服务对象在全局目录服务中注册，允许联邦网络中的服务请求者查询和访问这些服务。

## 移动代理范型

- 移动 Agent 是一种可移动的程序或对象。可以代替一些机器执行任务。例如：利用空闲计算机完成密集型计算，计算程序（连同数据）从一个机器移动到另一个机器，在目的机上运行
- 和移动代码的区别：移动代码是服务器与客户端之间传递代码，后者是在服务器之间传递。
- 和远程调用比较：减少数据传输，降低通信开销。安全威胁限制了它的使用。

## 云服务范型

### 基础设施即服务（IaaS）

- IaaS 通过创建虚拟的计算、存储中心，使其能够把计算单元、存储器、I/O 设备、带宽等计算机基础设施集中起来成为一个虚拟的资源池来对外提供服务
- IaaS 的主要用户是系统管理员
- IaaS 基本功能：资源抽象、资源部署、资源监控、安全管理、负载管理、计费管理、数据管理

### 平台即服务（PaaS）

- PaaS 提供应用服务引擎，通过互联网以服务的形式把如互联网应用编程接口、计算环境、开发环境、运行平台等提供给用户使用
- PaaS 的主要用户是开发人员
- PaaS 主要产品：Google App Engine、Windows Azure Platform
- PaaS 的主要功能：友好的开发环境、丰富的服务、自动的资源调度、精细的管理和监控

### 软件即服务（SaaS）

- SaaS 通过互联网以服务的形式把软件及应用程序按需提供给用户使用
- SaaS 的主要用户是普通用户
- SaaS 的主要功能：随时随地访问、支持公开协议、安全保障、多住户机制
