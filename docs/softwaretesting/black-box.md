# 黑盒测试方法

## 基本概念

**黑盒测试**（black-box testing）是一种常用的软件测试方法，它将被测软件看作一个打不开的黑盒，主要根据功能需求设计测试用例，进行测试。

黑盒测试是从**用户观点**出发的测试（与其相对，白盒测试则是从**系统观点**出发的测试），其目的是尽可能发现软件的外部行为错误。

黑盒测试的两个显著优点：

- 黑盒测试与软件具体实现无关，所以如果软件实现发生了变化，测试用例仍然可以使用；
- 设计黑盒测试用例可以和软件实现同时进行（或者先于软件实现，解耦），因此可以压缩项目总的开发时间。

## 测试技术

课程中介绍的黑盒测试技术主要包括以下：

- 等价类划分法（Equivalence partitioning）
- 边界值分析法（Boundary value analysis）
- 因果图法（Cause-effect graph）
- 决策表法（Decision table testing）

另外[Wikipedia](https://en.wikipedia.org/wiki/Black-box_testing)上还有其他方法及补充介绍，有兴趣的同学请自行了解啦~

本文后面着重讲解等价类划分法与边界值分析法

### 等价类划分法

#### 等价类划分法概述

等价类划分法是一种典型的黑盒测试方法，它完全不考虑程序的内部结构，只根据程序规格说明书对输入范围进行**划分**，把所有可能的输入数据，即程序输入域划分为若干个互不相交的子集，称为等价类，然后从每个等价类中选取少数具有代表性的数据作为测试用例，进行测试。

> 注：谈起“等价类”、“划分”、“细分”等概念，希望你能想起《离散数学》中所讲的“关系——等价关系——等价类”这个链条，如果你忘记了，不妨花些时间回顾一下这些内容。

<!-- TODO 待补充离散数学等价类讲解知识 -->

从软件测试的角度去理解等价类划分

- 定义：所谓等价类是指输入域的某个互不相交的子集合，所有等价类的并便是整个输入域。
- 区分：
  - 有效等价类：检验程序是否实现了规格说明预先规定的功能和性能。
  - 无效等价类：检查软件功能和性能的实现是否有不符合规格说明要求的地方。
- 常用的等价类划分原则
  - 按区间划分
  - 按数值划分
  - 按数值集合划分
  - 按限制条件或规则划分
  - 细分等价类

#### 等价类表

根据先前划分原则确立了等价类，得到**等价类表**

| 编号 | 输入条件 | 有效等价类 / 无效等价类 |
| :--: | :------: | :---------------------: |
|  -   |    -     |            -            | - |
|  -   |    -     |            -            | - |

为了方便看出使用的是什么划分原则，也可填入划分原则

| 编号 | 划分原则 | 输入条件 | 有效等价类 / 无效等价类 |
| :--: | :------: | :------: | :---------------------: |
|  -   |    -     |    -     |            -            | - |
|  -   |    -     |    -     |            -            | - |

#### 等价类测例设计

在设计测试用例时应同时考虑有效等价类和无效等价类测试用例的设计。根据等价类表设计测试用例，具体步骤如下：

- 为每个等价类规定一个唯一的编号。
- 设计一个新的测试用例，尽可能多地覆盖尚未被覆盖的有效等价类，重复这一步，直到测试用例覆盖了所有的有效等价类。
- 设计一个新的测试用例，使其覆盖并且只覆盖一个还没有被覆盖的无效等价类。重复这一步，直至测试用例覆盖了所有的无效等价类。

### 边界值分析法

#### 边界值分析法概述

**边界值和等价类密切相关**，输入等价类和输出等价类的边界是要着重测试的边界情况。在等价类的划分过程中产生了许多等价类边界。边界是最容易出错的地方，所以，从等价类中选取测试数据时应该关注边界值。

## 课程小实验

### 实验内容

- 编写一个实现两数相除的函数，并基于此，采用划分法和边界值法，设计相应的测试用例。请注意：程序的逻辑，以及测试用例和套件设计的合理性。
- 另外测试用例用表哥形式（简单形式），即用一个表，列出针对同一段代码的所有测试用例，通常要标明一个测试用例的编号、既定输入和预期输出（即测试所涉及的人机交互流程），以及相关注意事项。

### 实验过程

<!-- TODO 指向代码仓库 -->

[详细参见代码仓库](https://github.com/disc0ver-csu/software-testing)。

同样，只给出部分测例设计和核心逻辑代码（这个写的比较简陋，希望有同学能提供更好的版本）。

??? 黑盒测试核心逻辑代码

    ```C++
    if (!a_type)
    {
        flag = false;
        cout << "Error: a=" << a << " is not a num." << endl;
    }
    if (!b_type)
    {
        flag = false;
        cout << "Error: b=" << b << " is not a num." << endl;
    }
    if (!flag)
    {
        cout << "Try Again." << endl;
        continue;
    }
    a_double = stod(a, string::size_type());
    b_double = stod(b, string::size_type());
    if (a_double < LOW_BOUND + EPS || a_double >UP_BOUND - EPS)
    {
        flag = false;
        cout << "Error a=" << a_double << " out of bound." << endl;
    }
    if (b_double < LOW_BOUND + EPS || b_double >UP_BOUND - EPS)
    {
        flag = false;
        cout << "Error b=" << b_double << " out of bound." << endl;
    }
    // 对0的判断
    if (abs(b_double) < EPS)
        {
        flag = false;
        cout << "Error b=" << 0 << " undevisable." << endl;
    }
    if (!flag)
    {
        cout << "Try Again." << endl;
        continue;
    }
    // 进行运算
    double ans = getDevide(a_double, b_double);
    cout << "Correct! The value is " << ans << " ."<< endl;
    ```

- 等价类划分表格

  | 编号 | 划分原则 | 情况                          | 有效/无效等价类 |
  | :--- | :------- | :---------------------------- | :-------------- |
  | 1    | 数值类型 | a 为数值，b 为数值            | 有              |
  | 2    | 数值类型 | a，b 至少有一个为非数值       | 无              |
  | 3    | 区间     | -100< a <100, -100< b <100    | 有              |
  | 4    | 区间     | a，b 至少有一个不在要求区间内 | 无              |
  | 5    | 特殊值   | b 不为 0                      | 有              |
  | 6    | 特殊值   | b 为 0                        | 无              |

- 等价类测例设计

  交给你啦（别忘了写清楚覆盖的等价类）

- 边界值

  主要考虑输入符合数值规范下，是否控制在限定区间内。在本题程序中，限定

  - 被除数： $(-100,100)$
  - 除数： $(-100,0) \cup (0,100)$

  除数为 0 的检测在上面等价类划分中做过了，这里就不再重复测试了，主要针对-100，100 上下边界进行测试中，在程序中我定义了宏名`LOW_BOUND`和`UP_BOUND`方便表示。

- 边界值测例表格

  | 测例编号 | 输入          | 预计输出 | 实际输出 |
  | :------- | :------------ | :------- | :------- |
  | 1        | a=-100 b=-100 | 2 Error  | 2 Error  |
  | -        | -             | -        | -        |

  补充完成测例表格就交给你了。
