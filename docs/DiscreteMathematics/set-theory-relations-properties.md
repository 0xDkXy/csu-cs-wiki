# 集合论——关系及其性质

我们可以用两个相关元素构成的有序对来表达两个集合元素之间的关系，序偶组成的集合就是二元关系。

**关系**：设$A$和$B$是集合，一个从$A$到$B$的二元关系是$A \times B$（笛卡尔积）的子集。

初识“关系”时可能对他的名字不太能理解，实际上它就是我们生活中所描述“关系”的一种数学抽象，比如$\{ (a,b),(b,a),(a,c),(c,a) \}$可以描述$a,b,c$三人的朋友关系（从此处可以看出朋友关系是对称的），再如$\{(1,1),(1,2),(1,3),(2,2),(2,3),(3,3)\}$描述了$1,2,3$的“小于等于”关系。

## 集合上的关系

**集合上的关系**：从$A$到$A$的关系，换句话说，集合$A$上的关系是$A \times A$的子集。

??? note "含$n$个元素的集合$A$上有多少种关系"

    笛卡尔积$A \times A$共$n^2$个元素，根据集合元素与幂集合元素的关系，我们可知，关系有$2^{n^2}$种。

## 关系的性质

用量词去描述这些性质。设$R$为集合$A$上的关系。

| 量词描述                                                                                       | 性质                      |
| :--------------------------------------------------------------------------------------------- | :------------------------ |
| $\forall a ( (a,a) \in R )$                                                                    | 自反性（reflexive）       |
| $\forall a ( (a,a) \notin R )$                                                                 | 反自反性（irreflexive）   |
| $\forall a \forall b ( (a,b) \in R \rightarrow (b,a) \in R )$                                  | 对称性（symmetric）       |
| $\forall a \forall b ( ((a,b) \in R \land (b,a) \in R) \rightarrow ( a=b ))$                   | 反对称性（antisymmetric） |
| $\forall a \forall b \forall c ( ((a,b) \in R \land (b,c) \in R) \rightarrow ((a,c) \in R)  )$ | 传递性（transitive）      |

## 关系的表示

关系常见的表示方式：矩阵（Zero-one matrices）和关系图（directed graphs）

### 矩阵

假设$R$，是从$A = \{ a_1,a_2,a_3,\cdots,a_m \}$到$B = \{ b_1,b_2,b_3,\cdots,b_n \}$的关系，我们可以用矩阵$M_R = [m_{ij}]$来表示，其中：

$$
m_{ij} = \left\{
    \begin{aligned}
        1 & &(a_i,b_i) \in R \\
        0 & &(a_i,b_i) \notin R \\
    \end{aligned}
\right.
$$

??? note "一些常见的关系矩阵表示"

    自反关系矩阵，非主对角线的其它元素可以为0或1。

    $$
    \begin{bmatrix}
        1 &   &   &   &   & \\
          & 1 &   &   &   & \\
          &   & \cdot &   &   & \\
          &   &   & \cdot  &   & \\
          &   &   &   & 1 & \\
          &   &   &   &   & 1 \\
    \end{bmatrix}
    $$

    对阵阵（举例）

    $$
    \begin{bmatrix}
          &   & 1 &   &   & \\
          &   &   &   & 0 & \\
        1 &   &   &   &   & \\
          &   &   &   &   & \\
          & 0 &   &   &   & \\
          &   &   &   &   &  \\
    \end{bmatrix}
    $$

    注意，反对称性与“非对称”并不一致，你可以找到一个关系既是对称又是反对称的，比如空关系。你也可以找到即非对称也非反对称的关系，比如下面矩阵表示的关系。

    $$
    \begin{bmatrix}
        0 & 1 & 0 \\
        1 & 0 & 1 \\
        0 & 0 & 0 \\
    \end{bmatrix}
    $$

### 关系图

把集合中的每个元素表示成一个点，每个有序对表示成一条带有箭头的弧，弧上箭头标明了弧的方向。当我们把一个有穷集上的关系看作一个**有向图**时，就以这种图形表示。

（由于 Latex 不好绘制这种图，这里就省略了）

## 关系的组合

关系是序偶的集合，因此可以进行集合的运算如交、并、差、补。这里就不展开叙述了，关系还有另一种组合方式，这里称之为“合成运算”。

**合成运算**：设$R_1$是从集合$A$到集合$B$的关系，$R_2$是从集合$B$到集合$C$的关系。则从$A$到$C$的合成关系表述为（合成符号因书而异，英文教辅写为 $R_2 \circ R_1$，中文教材中写为$R_1R_2$或者$R_1 \cdot R_2$ ）：

$$ R_2 \circ R_1 = \{ (a,c) | a\in A \land c \in C \land \exists b ( b \in B \land (a,b) \in R_1 \land (b,c) \in R_2  ) \}$$

??? note "矩阵表示关系的组合"

    假设集合$A$上的关系$R_1$和$R_2$用矩阵表示为$M_{R_1} = \begin{bmatrix}
        1 & 0 & 1 \\
        1 & 0 & 0 \\
        0 & 1 & 0
    \end{bmatrix}$，
    $M_{R_2} = \begin{bmatrix}
        1 & 0 & 1 \\
        0 & 1 & 1 \\
        1 & 0 & 0
    \end{bmatrix}$，那么$R_1 \cup R_2$和$R_1 \cap R_2$的矩阵表示为？

    $$M_{R_1 \cup R_2} = M_{R_1} \lor M_{R_2} = \begin{bmatrix}
        1 & 0 & 1 \\
        1 & 1 & 1 \\
        1 & 1 & 0
    \end{bmatrix}$$

    $$M_{R_1 \cap R_2} = M_{R_1} \land M_{R_2} = \begin{bmatrix}
        1 & 0 & 1 \\
        0 & 0 & 0 \\
        0 & 0 & 0
    \end{bmatrix}$$

    需要注意的是，交、并等运算一般建立在关系的定义域与值域相同，所以矩阵。而合成关系则是要求以中间集合做“桥接”，在矩阵中表示为列数=行数。

    比如设$X = \{1,2\}$，$Y = \{a,b,c\}$，$Z=\{\alpha,\beta\}$，$R_1$是$X$到$Y$的关系，而$R_2$是$Y$到$Z$的关系，用矩阵表示为：

    $$
    M_{R_1} = \begin{bmatrix}
        1 & 1 & 0 \\
        0 & 0 & 1
    \end{bmatrix}
    ,
    M_{R_2} = \begin{bmatrix}
        0 & 1 \\
        0 & 1 \\
        0 & 0
    \end{bmatrix}
    $$

    则合成关系$R_2 \circ R_1$（中文教材上表示为$R_1 \cdot R_2$）为：

    $$
    M_{R_2 \circ R_1} = M_{R_1} \cdot M_{R_2} =
    \begin{bmatrix}
        1 & 1 & 0 \\
        0 & 0 & 1
    \end{bmatrix}
    \cdot
    \begin{bmatrix}
        0 & 1 \\
        0 & 1 \\
        0 & 0 \\
    \end{bmatrix}
    =
    \begin{bmatrix}
        0 & 1 \\
        0 & 0
    \end{bmatrix}
    $$

由两个关系的合成可以递归地定义关系$R$的幂。

**关系的幂**：定义$R^1 = R$和$R^{n+1} = R^n \circ R$

下面定理证明了一个传递关系的幂是该关系的子集。

!!! note "集合$A$上的关系$R$是传递的，当且仅当对所有正整数$n$有$R^n \subseteq R$"

    **充分性**：考虑$R^2 \subseteq R$，对于任意$a,b,c$，其中$(a,b) \in R$且$(b,c) \in R$，则根据合成运算$(a,c) \in R^2$，而$R^2 \subseteq R$，所以$(a,c) \in R$，传递性得证。

    **必要性**：数学归纳法，显然$n=1$，结果成立。假设$R^n \subseteq R$，不妨设$(a,b) \in R^{n+1}$，则根据关系合成存在一个$x$使得$(a,x) \in R$并且$(x,b) \in R^n$，根据归纳假设，$(x,b) \in R$，又因前提，$R$是传递的，所以$(a,b) \in R$，故$R^{n+1} \subseteq R$。

    **思考**：

    $$R^2 \subseteq R \Leftrightarrow R ~~ is ~~ transitive \Leftrightarrow R^n \subseteq R$$

    是否成立

<!-- TODO -->

还需补充 闭包、特殊的关系（等价关系、偏序），以及衍生出的问题。

## 闭包

**闭包**：一般来说，设$R$是集合$A$上的关系。$R$可能具有或者不具有某些性质$P$，例如自反性、对称性或传递性。如果存在包含$R$的具有性质$P$的关系$S$，并且$S$是所有包含$R$且具备性质$P$的关系或子集，那么$S$叫作$R$的关于性质$P$的**闭包**。

1.  **求自反闭包**

    $R$与对角关系的并，$r(R) = R \cup \Delta$

2.  **求对称闭包**

    $R$与$R$的逆（$R^{-1}$）的并，$s(R) = R \cup R^{-1}$

3.  **求传递闭包**（难点）

    不能通过类似自反闭包和对称闭包的求法，比如$R = \{(1,2),(2,3),(3,4)\}$，我们发现缺少$(1,3),(2,4)$，并入后，我们会发现，新引入的序偶还会产生新的传递性矛盾（比如在本例中缺少$(1,4)$）。这时候需要引入一些新的概念。

    **路径**（Path）：有向图$G$中，从$a$到$b$的路径描述为边的序列，如$(x_0,x_1),(x_1,x_2),\cdots,(x_n-1,x_n)$。其中$n$是一个非负整数。路径概念也可用于关系。

    根据路径定义，有下述定理：

    > 设$R$是集合$A$上的关系。从$a$到$b$存在一条长为$n$的路径，当且仅当$(a,b) \in R^n$。

    ??? note "数学归纳法证明"

        待补充

    **连通性**，$R$是集合$A$上的关系。连通性关系$R^*$由形如(a,b)的有序对构成，使得在关系$R$中，从$a$到$b$之间存在一条长度至少为 1 的路径。如果$(a,b) \in R^*$，我们称$a$到$b$是连通的。

    连通性只考虑存在而不考虑路径长短，而我们根据之前的定理知道，$R^i$中每个有序对$(a,b)$，表示存在一条从$a$到$b$，长度为$i$的路径。所以，$R^*$是所有$R^i$的并集：

    $$R ^ * = \bigcup_{i=1}^\infty R^n$$

    有了上面的基础，我们可以证明关系$R$的传递闭包等于连通性关系$R^*$（证明过程自行了解，注意分为传递性和“最小”性两部分证明），所以传递闭包可用下式求出：

    $$t(R) = R^*  = \bigcup_{i=1}^{\infty} R^i = R \cup R^2 \cup R^3 \cdots$$

    矩阵运算表达：

    $M_{R^*} = M_R \lor M_R^{[2]} \lor M_R^{[3]} \lor \cdots \lor M_R^{[n]}$

    <!-- TODO 沃舍尔算法 -->
